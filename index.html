<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
<title>Otanjoubi Omedetou Wulan Ayu Dwi Wahyuni ‚Äî Party Edition</title>

<style>
  :root{ --glass: rgba(0,0,0,0.45); --accent:#ff59d9; --accent2:#ffd6f4; }

  body {
    margin: 0;
    overflow: hidden;
    background: linear-gradient(180deg,#070512 0%, #1b1530 100%);
    font-family: 'Poppins', system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    color: #fff;
  }

  /* START SCREEN */
  #startScreen{
    position: fixed; inset:0;
    background: linear-gradient(135deg,#ffd6f4 0%, #ffb7f5 60%, #ff75e6 100%);
    display:flex; flex-direction:column; justify-content:center; align-items:center;
    text-align:center; z-index:1000;
  }
  #startScreen.hidden { display: none; }
  #startScreen h2{ font-size:26px; color:#2a0030; text-shadow:0 4px 20px rgba(0,0,0,0.25); margin-bottom:18px; animation:floatUp 2s infinite; }
  #openBtn{ padding:16px 36px; font-size:20px; border-radius:999px; border:none; background:linear-gradient(90deg,var(--accent),#ff0066); color:#fff; cursor:pointer; box-shadow:0 8px 30px rgba(255,0,160,0.25); animation:pulse 1.6s infinite; }

  @keyframes pulse{ 0%{transform:scale(1)}50%{transform:scale(1.06)}100%{transform:scale(1)} }
  @keyframes floatUp{ 0%,100%{transform:translateY(0)}50%{transform:translateY(-10px)} }

  /* MESSAGE (CENTERED) */
  #messageBox{ position:fixed; inset:0; display:none; justify-content:center; align-items:center; z-index:20; pointer-events:none; }
  #messageContent{
    width:92%; max-width:760px; background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(0,0,0,0.12));
    padding:28px; border-radius:24px; text-align:center; color:#fff; font-size:20px;
    pointer-events:auto; position:relative; overflow:visible; backdrop-filter: blur(6px);
    box-shadow: 0 20px 60px rgba(0,0,0,0.5);
    transform-origin:center;
  }

  #title{ font-size:30px; margin-bottom:8px; display:inline-block; padding:8px 14px; border-radius:12px; background:linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,0,160,0.02)); }
  .neonTitle{ transition: transform .45s ease, color .45s ease, text-shadow .45s ease; -webkit-text-stroke: 0.6px rgba(0,0,0,0.12); }

  #typedText{ font-size:18px; white-space:pre-line; line-height:1.5; text-shadow:0 0 8px rgba(255,150,240,0.15); min-height:120px; margin:8px 0 6px; }
  .funnyLine { font-weight:700; font-size:15px; color:#ffd6f4; margin-top:6px; }

  .bigHeart{ font-size:48px; display:inline-block; margin-top:8px; transform-origin:center; animation:beat 1.2s infinite; filter:drop-shadow(0 6px 18px rgba(255,80,180,0.9)); will-change: transform; }
  @keyframes beat{ 0%{transform:scale(1)}25%{transform:scale(1.14)}50%{transform:scale(0.96)}75%{transform:scale(1.08)}100%{transform:scale(1)} }

  .btnRow{ display:flex; gap:12px; justify-content:center; margin-top:12px; flex-wrap:wrap; }
  .btn{ padding:10px 18px; background:linear-gradient(90deg,var(--accent),#ff3a9b); border-radius:999px; color:#fff; border:none; cursor:pointer; font-weight:700; box-shadow:0 8px 20px rgba(0,0,0,0.35); }
  .btn.secondary{ background: rgba(255,255,255,0.06); border:1px solid rgba(255,255,255,0.06); color:var(--accent2); }

  /* FUNNY PARTY HAT on title */
  .partyHat{
    position: absolute; left: calc(50% + 160px); top: 12px; transform-origin:center; animation:hatWiggle 2.2s infinite;
    font-size:28px; pointer-events:none;
  }
  @keyframes hatWiggle { 0%{transform:rotate(-6deg)}50%{transform:rotate(6deg)}100%{transform:rotate(-6deg)} }

  /* LOVE FLOATING optimized */
  .love{ position:fixed; bottom:-10px; pointer-events:none; will-change: transform, opacity; transform: translate3d(0,0,0); }
  @keyframes floatLove{ 0%{transform:translateY(0) translateX(0) scale(1); opacity:1} 50%{transform:translateY(-48vh) translateX(8vw) scale(1.12); opacity:0.9} 100%{transform:translateY(-110vh) translateX(-12vw) scale(1.6); opacity:0} }

  .popEmoji{ position:fixed; font-size:36px; animation:popEmojiAnim .48s cubic-bezier(.2,.9,.2,1) forwards; pointer-events:none; will-change: transform, opacity; }
  @keyframes popEmojiAnim{ 0%{transform:scale(0); opacity:0} 60%{transform:scale(1.45); opacity:1} 100%{transform:scale(1); opacity:.7} }

  /* CONFETTI pieces (CSS fallback) */
  .confettiPiece{
    position:fixed; width:8px; height:12px; opacity:0.95; transform-origin:center; pointer-events:none; will-change: transform, opacity;
  }

  /* FIREWORK CANVAS */
  #canvas{ position:fixed; inset:0; z-index:5; display:block; }

  /* END SCREEN */
  #endScreen{
    position:fixed; inset:0; display:none; z-index:2000;
    background: linear-gradient(180deg, rgba(10,8,20,0.95), rgba(20,12,40,0.95));
    display:grid; place-items:center; text-align:center; padding:20px; color:#fff;
  }
  #endInner{
    max-width:760px; width:92%; display:flex; flex-direction:column; gap:18px; align-items:center;
  }

  #signature{
    position: absolute; right:18px; bottom:14px; font-size:16px; opacity:0.95; color:#ffd6f4; font-style:italic; pointer-events:none;
  }

  /* neonTime compact */
  .neonTime{ font-weight:700; letter-spacing:0.4px; color:#ffe5ff; text-shadow:0 0 6px rgba(255,120,220,0.8); padding:6px 10px; border-radius:999px; display:inline-block; font-size:14px; }
  #timeWrapper{ display:flex; flex-direction:column; align-items:center; gap:2px; margin-bottom:6px; }

  /* responsive tweaks */
  @media (min-width:600px){ #title{ font-size:36px } #typedText{ font-size:19px } }
  @media (max-width:420px){ .bigHeart{ font-size:36px } #messageContent{ padding:18px; border-radius:18px } .partyHat{ left: calc(50% + 120px); } }
</style>
</head>
<body>

<!-- AUDIO (not autoplay) -->
<audio id="bgm" src="http://bit.ly/3LTPnj4" loop></audio>
<audio id="popSfx" src="https://www.soundjay.com/buttons/sounds/button-16.mp3"></audio>
<audio id="fireSfx" src="https://www.soundjay.com/misc/sounds/bell-ringing-05.mp3"></audio>

<!-- START -->
<div id="startScreen" aria-modal="true" role="dialog">
  <h2>üéÄ Ada pesan spesial untuk Wulan ‚Äî Siap ketawa & terharu?</h2>
  <button id="openBtn">üíå Buka Pesan ‚Äî Ayo!</button>
</div>

<!-- MESSAGE -->
<div id="messageBox" aria-hidden="true">
  <div id="messageContent" role="document" aria-labelledby="title">

    <h1 id="title" class="neonTitle" role="heading" aria-live="polite">
      üéâ Otanjoubi Omedetou üéâ<br>
      WULAN AYU D.W.
    </h1>
    <div class="partyHat" aria-hidden="true">üé©</div>

    <div id="timeWrapper">
      <p id="birthInfo" class="neonTime smallNeon" aria-live="polite"></p>
      <p id="currentDateTime" class="neonTime smallNeon" aria-live="polite"></p>
    </div>

    <p id="typedText" aria-live="polite"></p>
    <div id="funnyHint" class="funnyLine" aria-hidden="true"></div>

    <div id="heartWrap" aria-hidden="true">
      <span class="bigHeart">‚ù§Ô∏è</span>
    </div>

    <div class="btnRow" style="margin-top:12px;">
      <button id="finishBtn" class="btn secondary" style="display:none;">Selesai üéà</button>
      <button id="muteBtn" class="btn" title="Matikan / hidupkan musik">üîä</button>
    </div>
  </div>
</div>

<!-- END -->
<div id="endScreen" role="dialog" aria-modal="true">
  <div id="endInner">
    <h2>Terima kasih sudah buka pesan üéÄ</h2>
    <p>Semoga hari ini penuh berkah, tawa, dan cake üç∞. Klik ambil giftnya yaa~</p>
    <div class="btnRow">
      <button id="replayBtn" class="btn">Mainkan Lagi</button>
      <button id="backStartBtn" class="btn secondary">Ambil Gift</button>
    </div>
  </div>
  <div id="signature">from Bubby</div>
</div>

<!-- CANVAS FIREWORK -->
<canvas id="canvas"></canvas>

<script>
document.addEventListener('DOMContentLoaded', () => {

  /* ----------------------------
     Date / Age logic (unchanged but explicit)
     ---------------------------- */
  function computeAgeDetailed(birthDate, now) {
    let years = now.getFullYear() - birthDate.getFullYear();
    let months = now.getMonth() - birthDate.getMonth();
    let days = now.getDate() - birthDate.getDate();

    if (days < 0) {
      const prevMonth = new Date(now.getFullYear(), now.getMonth(), 0);
      days += prevMonth.getDate();
      months -= 1;
    }
    if (months < 0) {
      months += 12;
      years -= 1;
    }
    return { years, months, days };
  }

  function updateBirthInfo() {
    const birthDate = new Date(2004, 0, 1); // 01 Jan 2004
    const now = new Date();
    const daysName = ["Minggu","Senin","Selasa","Rabu","Kamis","Jumat","Sabtu"];
    const birthDayName = daysName[birthDate.getDay()];
    const age = computeAgeDetailed(birthDate, now);
    const birthString = `${birthDayName}, 01 - 01 - 2004`;
    const parts = [];
    if (age.years) parts.push(`${age.years} Thn`);
    if (age.months) parts.push(`${age.months} Bln`);
    if (age.days || parts.length === 0) parts.push(`${age.days} Hr`);
    document.getElementById("birthInfo").innerText = `üìÖ Lahir: ${birthString} (Usia: ${parts.join(' ')})`;
  }

  function updateDateTime() {
    const dt = new Date();
    const daysName = ["Minggu","Senin","Selasa","Rabu","Kamis","Jumat","Sabtu"];
    const dayName = daysName[dt.getDay()];
    const day = String(dt.getDate()).padStart(2,'0');
    const month = String(dt.getMonth()+1).padStart(2,'0');
    const year = dt.getFullYear();
    const time = dt.toLocaleTimeString("id-ID", { hour: "2-digit", minute: "2-digit", second: "2-digit" });
    document.getElementById("currentDateTime").innerText = `${dayName}, ${day} - ${month} - ${year} ‚Äî ${time}`;
    updateBirthInfo();
  }

  updateBirthInfo();
  updateDateTime();
  setInterval(updateDateTime, 1000);

  /* ----------------------------
     UI elements
     ---------------------------- */
  const startScreen = document.getElementById("startScreen");
  const openBtn = document.getElementById("openBtn");
  const bgm = document.getElementById("bgm");
  const popSfx = document.getElementById("popSfx");
  const fireSfx = document.getElementById("fireSfx");

  const messageBox = document.getElementById("messageBox");
  const typedText = document.getElementById("typedText");
  const funnyHint = document.getElementById("funnyHint");
  const finishBtn = document.getElementById("finishBtn");
  const muteBtn = document.getElementById("muteBtn");
  const endScreen = document.getElementById("endScreen");
  const replayBtn = document.getElementById("replayBtn");
  const backStartBtn = document.getElementById("backStartBtn");

  let playing = false;

  startScreen.style.display = "flex";
  messageBox.style.display = "none";
  endScreen.style.display = "none";
  finishBtn.style.display = "none";
  typedText.textContent = "";

  // Fun random hints
  const hints = [
    "Catatan: Jangan makan kue dulu, foto duluuu üì∏",
    "Wulan, semoga semakin kece & banyak rejeki ‚ú®",
    "Hadiah: Pelukan virtual + 1 lagu special üéµ",
    "PS: Tertawa itu gratis, pakai sebanyak-banyaknya üòÜ"
  ];

  function randomHint(){ funnyHint.innerText = hints[Math.floor(Math.random()*hints.length)]; }
  randomHint();

  /* ----------------------------
     Smooth time-based typing (requestAnimationFrame)
     ---------------------------- */
  const message =
`Semoga dihari ulang tahun ini 
penuh dengan kebahagiaan, tawa,
dan cinta dari orang-orang terdekat. üòÑ

Mudah-mudahan tahun depan
membawa lebih banyak kesuksesan,
kesehatan, dan impian yang tercapai. üåü

Dari hati ke hati, Otanjoubi omedetou! üéÇ‚ù§Ô∏è
Dan Selamat Tahun Baru üéâ`;

  let typedIndex = 0;
  let typingActive = false;
  let lastTime = 0;
  const charsPerSecond = 28; // sesuaikan kecepatan; higher => faster
  let typedBuffer = "";

  function startTyping() {
    typingActive = true;
    typedIndex = 0;
    typedBuffer = "";
    typedText.textContent = "";
    finishBtn.style.display = "none";
    lastTime = performance.now();
    requestAnimationFrame(typingFrame);
  }

  function typingFrame(now) {
    if (!typingActive) return;
    const dt = (now - lastTime) / 1000; // seconds
    lastTime = now;
    const toAdd = Math.floor(dt * charsPerSecond);
    if (toAdd > 0) {
      // append chunk
      const nextIndex = Math.min(typedIndex + toAdd, message.length);
      typedBuffer += message.slice(typedIndex, nextIndex);
      typedIndex = nextIndex;
      // update DOM once per frame
      typedText.textContent = typedBuffer;
    }
    // playful pop sound occasionally when punctuation appears
    if (typedIndex > 0 && Math.random() < 0.01) { try { popSfx.currentTime = 0; popSfx.play().catch(()=>{}); } catch(e){} }

    if (typedIndex < message.length) {
      requestAnimationFrame(typingFrame);
    } else {
      typingActive = false;
      finishBtn.style.display = "inline-block";
      finishBtn.focus();
      // trigger a little flourish
      try { fireSfx.currentTime = 0; fireSfx.play().catch(()=>{}); } catch(e){}
    }
  }

  /* ----------------------------
     Optimized floats & confetti (GPU-friendly)
     ---------------------------- */
  function spawnLove() {
    const love = document.createElement("div");
    love.className = "love";
    const icons = ["‚ù§Ô∏è","üíñ","üíï","üíò","üíû","ü´∂"];
    love.innerHTML = icons[Math.floor(Math.random()*icons.length)];
    love.style.left = `${Math.random()*88 + 4}vw`;
    love.style.fontSize = `${(14 + Math.random()*26)}px`;
    love.style.opacity = `${0.7 + Math.random()*0.25}`;
    const dur = 3200 + Math.random()*2400;
    love.style.animation = `floatLove ${dur}ms linear forwards`;
    document.body.appendChild(love);
    setTimeout(()=> love.remove(), dur + 200);
  }

  function spawnEmoji() {
    const emojiList = ["üéâ","‚ú®","üåü","ü•≥","üéÄ","üç∞","üç≠"];
    const emoji = document.createElement("div");
    emoji.className = "popEmoji";
    emoji.innerHTML = emojiList[Math.floor(Math.random()*emojiList.length)];
    emoji.style.left = (Math.random()*82+8)+"vw";
    emoji.style.top = (Math.random()*62+18)+"vh";
    document.body.appendChild(emoji);
    setTimeout(()=> emoji.remove(), 700);
  }

  function spawnConfettiBurst() {
    const colors = ["#ff4bd1","#ffd6f4","#ff9ad6","#ffe07a","#a7fffb"];
    for (let i=0;i<26;i++){
      const c = document.createElement("div");
      c.className = "confettiPiece";
      c.style.left = (50 + (Math.random()*60-30))+"vw";
      c.style.top = (40 + (Math.random()*20-10))+"vh";
      c.style.background = colors[Math.floor(Math.random()*colors.length)];
      c.style.transform = `rotate(${Math.random()*360}deg)`;
      c.style.opacity = `${0.9 + Math.random()*0.1}`;
      document.body.appendChild(c);
      const ang = (Math.random()*Math.PI*2);
      const dist = 80 + Math.random()*220;
      const dur = 1200 + Math.random()*800;
      c.animate([
        { transform: `translate(0,0) rotate(${Math.random()*360}deg)`, opacity:1 },
        { transform: `translate(${Math.cos(ang)*dist}px, ${Math.sin(ang)*dist}px) rotate(${Math.random()*720}deg)`, opacity:0.1 }
      ], { duration: dur, easing: 'cubic-bezier(.2,.9,.2,1)'});
      setTimeout(()=> c.remove(), dur+60);
    }
  }

  /* ----------------------------
     Fireworks: optimized with pooling & lighter math
     ---------------------------- */
  const canvas = document.getElementById("canvas");
  const ctx = canvas.getContext("2d", { alpha: true });
  let w = canvas.width = window.innerWidth;
  let h = canvas.height = window.innerHeight;
  window.addEventListener("resize", ()=> { w = canvas.width = window.innerWidth; h = canvas.height = window.innerHeight; });

  // pools
  const particlePool = [];
  const activeParticles = [];
  const fireworks = [];

  function Particle() {
    this.reset = function(x,y,color,angle,speed,life){
      this.x = x; this.y = y; this.vx = Math.cos(angle)*speed; this.vy = Math.sin(angle)*speed;
      this.alpha = 1; this.color = color; this.life = life; this.decay = 0.015 + Math.random()*0.02;
    };
    this.update = function(){
      this.x += this.vx;
      this.vy += 0.06; // gravity (light)
      this.y += this.vy;
      this.alpha -= this.decay;
      return this.alpha <= 0;
    };
    this.draw = function(ctx){
      if (this.alpha <= 0) return;
      ctx.globalAlpha = this.alpha;
      ctx.fillStyle = this.color;
      ctx.fillRect(this.x, this.y, 2.5, 2.5);
      ctx.globalAlpha = 1;
    };
  }

  function obtainParticle(x,y,color,angle,speed,life){
    let p = particlePool.pop();
    if (!p) p = new Particle();
    p.reset(x,y,color,angle,speed,life);
    activeParticles.push(p);
    return p;
  }

  class Firework {
    constructor(){
      this.x = Math.random()*w;
      this.y = h + 10;
      this.targetY = 100 + Math.random()*(h*0.45);
      this.speed = 6 + Math.random()*3;
      this.color = `hsl(${Math.floor(Math.random()*360)},90%,60%)`;
      this.exploded = false;
    }
    update(){
      this.y -= this.speed;
      if (this.y <= this.targetY && !this.exploded) {
        this.exploded = true;
        this.explode();
        return true; // remove rocket
      }
      return false;
    }
    explode(){
      const count = 20 + Math.floor(Math.random()*18);
      for (let i=0;i<count;i++){
        const angle = (Math.PI*2) * (i/count) + (Math.random()*0.4-0.2);
        const speed = 1.8 + Math.random()*3.8;
        obtainParticle(this.x, this.y, this.color, angle, speed, 60 + Math.random()*40);
      }
      // small audio cue (do not block)
      try { fireSfx.currentTime = 0; fireSfx.play().catch(()=>{}); } catch(e){}
      spawnConfettiBurst();
    }
    draw(ctx){
      ctx.beginPath();
      ctx.arc(this.x, this.y, 2.8, 0, Math.PI*2);
      ctx.fillStyle = this.color;
      ctx.fill();
      // small tail
      ctx.fillStyle = 'rgba(255,255,255,0.06)';
      ctx.fillRect(this.x-1, this.y+4, 2, 6);
    }
  }

  function loop() {
    // soft trail background (less clearing for smoother trails)
    ctx.fillStyle = "rgba(3,3,6,0.18)";
    ctx.fillRect(0,0,w,h);

    // spawn fireworks occasionally, but not too many
    if (Math.random() < 0.05) fireworks.push(new Firework());

    // update/draw fireworks
    for (let i = fireworks.length-1; i>=0; i--){
      const f = fireworks[i];
      f.draw(ctx);
      if (f.update()) fireworks.splice(i,1);
    }

    // update particles (iterate backward to splice safely)
    for (let i = activeParticles.length-1; i>=0; i--){
      const p = activeParticles[i];
      if (p.update()) {
        particlePool.push(p);
        activeParticles.splice(i,1);
      } else {
        p.draw(ctx);
      }
    }

    requestAnimationFrame(loop);
  }
  loop();

  /* ----------------------------
     Start / flow
     ---------------------------- */
  let heartTimer = null;
  let emojiTimer = null;

  openBtn.addEventListener("click", () => {
    // UI show
    startScreen.style.display = "none";
    messageBox.style.display = "flex";
    messageBox.setAttribute('aria-hidden','false');

    // start audio after user click
    try { bgm.currentTime = 0; bgm.play().catch(()=>{}); } catch(e){}

    // start typing & effects
    startTyping();

    if (heartTimer) clearInterval(heartTimer);
    if (emojiTimer) clearInterval(emojiTimer);
    heartTimer = setInterval(spawnLove, 420);
    emojiTimer = setInterval(spawnEmoji, 900);

    // occasionally spawn fireworks
    // already in loop; spawn a few immediate bursts for excitement
    for (let i=0;i<2;i++) setTimeout(()=>fireworks.push(new Firework()), 300*i + 150);
  });

  finishBtn.addEventListener("click", () => {
    // stop timers
    if (heartTimer) { clearInterval(heartTimer); heartTimer = null; }
    if (emojiTimer) { clearInterval(emojiTimer); emojiTimer = null; }
    typingActive = false;

    // show end screen
    messageBox.style.display = "none";
    messageBox.setAttribute('aria-hidden','true');
    endScreen.style.display = "grid";

    try { bgm.pause(); } catch(e){}
  });

  // typing finishes automatically show finishBtn; user may press it.
  // allow pressing Enter to skip typing
  document.addEventListener("keydown", (e)=>{
    if (e.key === "Enter" && messageBox.style.display !== "none" && typingActive) {
      // fast-forward typing
      typedBuffer = message; typedIndex = message.length;
      typingActive = false;
      typedText.textContent = typedBuffer;
      finishBtn.style.display = "inline-block";
    }
  });

  replayBtn.addEventListener("click", ()=> location.reload());
  backStartBtn.addEventListener("click", ()=> window.open("https://id.shp.ee/jjVwRJq", "_blank"));

  // mute/unmute bgm
  muteBtn.addEventListener("click", ()=>{
    if (!bgm) return;
    if (bgm.muted) {
      bgm.muted = false;
      muteBtn.innerText = "üîä";
    } else {
      bgm.muted = true;
      muteBtn.innerText = "üîà";
    }
  });

  // accessibility: Enter to open from start screen
  document.addEventListener("keydown", (e) => {
    if (e.key === "Enter" && startScreen.style.display !== "none") {
      openBtn.click();
    }
  });

  // small performance tip: pause heavy loops on visibilitychange
  document.addEventListener('visibilitychange', ()=>{
    if (document.hidden) {
      try { bgm.pause(); } catch(e){}
    } else {
      // resume if user had started
      // we won't auto-play audio; user can enable via button if desired
    }
  });

  // show a new fun hint every 6 seconds while typing/visible
  setInterval(()=> { if (messageBox.style.display !== "none") randomHint(); }, 6000);

}); // DOMContentLoaded
</script>
</body>
</html>
